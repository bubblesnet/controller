extends asynclayout
include mixins

block content
    script(type="text/javascript" src="http://code.jquery.com/jquery-1.12.4.js" integrity="sha256-Qw82+bXyGq6MydymqBxNPYTaUXXq7c8v3CwiYwLLNXU=" crossorigin="anonymous")
    script(type='text/javascript').
        console.log("subscribing");
        $(function () {
            bubbles.subscribeToServer('subscribeToDevice', {deviceid: '70000031', userid: '90000009'}, 'deviceUpdate');
        });
        $(function () {
            stomp.subscribeToServer('subscribeToDevice', {deviceid: '70000031', userid: '90000009'}, function (data) {
                console.log('inbound message via callback = ' + JSON.stringify(data));
            });
        });

    div( id="div_date" )
        h1 Growbox Status as of #{moment(new Date(bubbles[0].measured_datetimemillis)).fromNow()}
        p #{moment(new Date(bubbles[0].measured_datetimemillis)).format("ddd MMM DD hh:mm:ss a")}

    table( width="100%" )
        +userAndDevice( bubbles )
        +diskStatus( bubbles )
        +waterLevelMonitoredSensorRow( bubbles[0].waterLevel, 'Water Level' )
        +atmosphericPressureMonitoredSensorRow( bubbles[0].airPressure, 'Atmospheric Pressure' )
        +proximitySwitchMonitoredSensorRow(bubbles[0].doorStates.CABINET, 'Door')
        +proximitySwitchMonitoredSensorRow(bubbles[0].doorStates.CLOSET, 'Door')
        +temperatureMonitoredSensorRow( bubbles[0].temperatures.CABINETAIRTOP )
        +temperatureMonitoredSensorRow( bubbles[0].temperatures.CABINETAIRMIDDLE )
        +temperatureMonitoredSensorRow( bubbles[0].temperatures.CABINETAIRBOTTOM )
        +humidityMonitoredSensorRow( bubbles[0].relativeHumidity, 'Relative Humidity' )
        +monitoredSensorRow( bubbles[0].pH, 'pH' )
        +distanceMonitoredSensorRow( bubbles[0].lightDistance, 'Distance light/plant' )
        +lightIntensityMonitoredSensorRow( bubbles[0].lightIntensity, 'Light intensity' )
        +airPumpMonitoredDeviceRow( bubbles[0], bubbles[0].airPumpMonitoredDevice )
        +waterPumpMonitoredDeviceRow( bubbles[0], bubbles[0].waterPumpMonitoredDevice )
        +lightMonitoredDeviceRow( bubbles[0], bubbles[0].lightStates.LEDGROWBLOOMING )
        +lightMonitoredDeviceRow( bubbles[0], bubbles[0].lightStates.LEDGROWVEGETATIVE )
        +lightMonitoredDeviceRow( bubbles[0], bubbles[0].lightStates.INCANDESCENTHEATnull )
        +fanMonitoredDeviceRow(bubbles[0], bubbles[0].fans.INLET)
        +fanMonitoredDeviceRow(bubbles[0], bubbles[0].fans.OUTLET)
        +humidifierMonitoredDeviceRow( bubbles[0], bubbles[0].humidifierMonitoredDevice )
        +picture( bubbles )
        +mostRecentEvents( bubbles[0].mostRecentEvents )
